<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MDS v4.0 - Clustering Demo</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: #0e0f12;
      color: #eee;
      overflow: hidden;
      font-family: system-ui, -apple-system, sans-serif;
    }

    .mds-entity {
      position: absolute;
      font-size: 40px;
      user-select: none;
      will-change: transform, opacity, filter;
      transition: filter 0.2s ease;
      cursor: pointer;
    }

    .info {
      position: fixed;
      top: 20px;
      left: 20px;
      font-size: 14px;
      line-height: 1.6;
      background: rgba(0, 0, 0, 0.5);
      padding: 16px;
      border-radius: 8px;
      max-width: 380px;
    }

    .info h2 {
      margin: 0 0 12px;
      font-size: 18px;
      color: #ffdc78;
    }

    .info p {
      margin: 8px 0;
      color: #ccc;
    }

    .info strong {
      color: #fff;
    }

    .legend {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.5);
      padding: 16px;
      border-radius: 8px;
      font-size: 12px;
    }

    .legend div {
      margin: 4px 0;
    }

    .legend span {
      display: inline-block;
      width: 60px;
      text-align: right;
      margin-right: 8px;
      color: #ffdc78;
    }
  </style>
</head>
<body>
  <div class="info">
    <h2>🌌 MDS v4.0 Demo B</h2>
    <p><strong>Self-Organizing Clustering</strong></p>
    <p>📊 5 entities with random entropy values (0..1)</p>
    <p>🧲 <strong>Info-physics rule:</strong> Similar entropy → Attract</p>
    <p>🎯 <strong>Formula:</strong> <code>similarity = 1 - |a.entropy - b.entropy|</code></p>
    <p>⚡ <strong>Force:</strong> <code>F = 0.05 × similarity</code></p>
    <p>📏 <strong>Threshold:</strong> 160px proximity</p>
    <p>⏱️ Watch them cluster within ~10 seconds</p>
  </div>

  <div class="legend" id="legend"></div>

  <script type="module">
    import { Engine } from '../dist/mds-core.esm.js'

    // Initialize engine
    const engine = new Engine()

    // Define emojis for visual distinction
    const emojis = ['🔴', '🟠', '🟡', '🟢', '🔵']

    // Spawn 5 entities with random entropy
    const entities = []
    const legend = document.getElementById('legend')

    for (let i = 0; i < 5; i++) {
      const entropy = Math.random()
      const material = {
        material: `test.${i}`,
        essence: `Entity ${i}`,
        manifestation: {
          emoji: emojis[i],
          aging: {
            start_opacity: 1,
            decay_rate: 0  // No decay for clustering demo
          }
        },
        physics: {
          mass: 0.1,
          friction: 0.02
        }
      }

      // Random spawn position
      const x = Math.random() * 600 + 100
      const y = Math.random() * 400 + 100

      const entity = engine.spawn(material, x, y)
      entity.entropy = entropy  // Override entropy
      entities.push(entity)

      // Add to legend
      const div = document.createElement('div')
      div.innerHTML = `<span>entropy:</span>${entropy.toFixed(3)} ${emojis[i]}`
      legend.appendChild(div)
    }

    // Start simulation
    engine.start()

    // Debug: Log clustering progress
    setInterval(() => {
      const positions = entities.map(e => ({
        emoji: e.m.manifestation.emoji,
        entropy: e.entropy.toFixed(3),
        x: e.x.toFixed(0),
        y: e.y.toFixed(0)
      }))
      console.log('Entities:', positions)
    }, 3000)

    console.log('🌌 MDS v4.0 - Clustering Demo Started')
    console.log('Watch entities with similar entropy cluster together')
    console.log('Similar values = stronger attraction force')
  </script>
</body>
</html>
